<div id="curtain" class="curtain"></div>

<div id="modal-container">

<!-- Signup window for new users -->
    <div id="modal-signup" class="modal-window">
        <h2>Just one more thing before we log you in..<small>We're almost there <strong><span id="modal-signup-name"></span></strong>, but first we'll need you to add a few more details to personalize your Tap experience.</small></h2>
    
        <form id="signup-form">
            <p class="forms">
            <label for="i-uname">Username</label>
            <input type="text" id="i-uname"
                   name="uname"
                   class="required validate-alphanum maxLength:20 minLength:4 userDoesNotExists"
                   data-tipid="tip-signup-user"
            />
            </p>

            <p class="forms">
            <label for="i-email">Email</label>
            <input type="text" id="i-email"
                   name="email"
                   class="required validate-email emailDoesNotExists"
                   data-tipid="tip-signup-email"
            />
            </p>

            <p class="forms">
            <label for="i-pass">Password</label>
            <input type="password" id="i-pass"
                   name="pass"
                   class="required minLength:6"
                   data-tipid="tip-signup-pass"
            />
            </p>

            <div class="sep"></div>
            <p class="forms" id="fb-button">
                <label for="fb-login-button" style="padding-right: 28px">Facebook</label>
                <fb:login-button 
                    id="fb-login-button"
                    show-faces="true"
                    width="300"
                    perms="<?=FBPERMISSIONS?>"
                    class="validate-facebook"
                    name="facebook"
                    data-tipid="tip-signup-facebook"
                ></fb:login-button>
            </p>

            <p class="modal-actions">
                <span class="indicator">
                    <img src="/static/spinner.gif" />
                    <span class="indic-msg">Signing you up...</span>
                </span>
                <span class="modal-actions">
                    <input type="submit" value="Start Tapping!"> <a class="modal-cancel" href="#">close</a>
                </span>
            </p>
        </form>
    </div>

<!-- Login -->
    <div id="modal-login" class="modal-window">
        <h2>Join conversation!</h2>
                    <form id="taplogin" action="/" method="POST">
                                    <p class="forms" style="margin-top:30px;">  
                                        <label class="inblock">Username</label>
                                        <input name="uname" type="text" class="basic" value="<?= $_POST['uname'] ?>" />
                                    </p>
                                    <p class="forms">
                                        <label class="inblock">Password</label>
                                        <input name="pass" type="password" class="basic" value="<?= $_POST['pass'] ?>" />
                                    </p>
                                    <div class="sep"></div>
                                    <p class="forms">
                                        <label for="facebook" class="smaller">Login with Facebook</label>
                                        <input name="facebook" type="checkbox">
                                        <span class="fb"><fb:login-button show-faces="true" width="300" perms="<?=FBPERMISSIONS?>"></fb:login-button></span>
                                    </p>
                                    <span class="modal-actions"><button id="login-button" type="submit">Log in</button></span>
                    </form>
                   
        <span class="modal-actions">
                <a class="modal-cancel" href="#">close</a>
        </span>
    </div>


<!-- Login or signup -->
    <div id="modal-sign-login" class="modal-window">
    <img class="modal-logo-large" src="http://circlefy.com/images/logo.png" />
        <div class="text">
        <h2>Hi there!<small>Select an option below</small></h2>
        <span class="modal-actions">
                <button class="signup-button">Sign up</button><button class="login-button">Log in</button><a class="modal-cancel" href="#">close</a>
        </span>
        </div>
    </div>

<!-- Notification for guests to login or signup -->
    <div id="modal-sign-notify" class="modal-window">
        <h2>You've just posted your first tap</h2>
        <p>In order to make your tap experience better, please, sign up or log in</p>
        <span class="modal-actions">
                <button class="signup-button">Sign up</button><button onClick="javascript: window.location.replace('/login')">Log in</button><a class="modal-cancel" href="#">close</a>
        </span>
    </div>

<!-- Post status on facebook -->
    <div id="modal-facebook-status" class="modal-window">
        <h2>Tap notice</h2>
        <p>Share your tap experience with your friends!</p>
        <input type="hidden" name="link">
        <div id="fb_preview" style="background-color: white; border: 1px solid #CCCCCC; width: 460px; color:#333333; font-family: 'lucida grande', tahoma, verdana, arial; font-weight: normal; text-align: left; overflow: hidden;font-size: 11px; padding: 4px;">
            <div>
                <h3 style="width: 340px; font-size: 13px; margin: 0; padding: 0">
                    <a class="fb_name" style="font-weight: bold; color: #3B5998; cursor: pointer; text-decoration: none"> </a>
                    <span class="fb_message" style="font-weight: normal;"> </span>
                </h3>
            </div>
            <div style="margin-bottom: 5px; margin-top: 6px; padding-right: 10px; overflow: hidden;">
                <div style="padding-right: 10px; float: left; overflow: hidden;">
                    There should be tap image
                </div>
                <div style="display: table;">
                    <div style="display: inline; font-weight: bold; padding-top: 3px">
                        <a style="color: #3B5998; cursor: pointer; text-decoration: none;">Join discussion</a>
                    </div>
                    <div class="caption" style="color: #808080; padding-top: 3px;"> </div>
                    <div style="display:inline; color: #808080; padding: 3px 0;">TAP communication platform</div>
                </div>
            </div>
        </div>
        <p class="forms" style="margin-top:30px"><label>Status</label> <input type="text" name="status" /></p>
        <p class="guide">Wrong story, bro</p>
        <p class="forms" style="margin-top:30px"><label>Message</label> <input type="text" name="message" /></p>
        <p class="guide">Wrong story, bro</p>
        <p class="modal-menu">
                <span class="indicator">
                        <img src="/static/spinner.gif" />
                        <span class="indic-msg">Publishing...</span>
                </span>
                <span class="modal-actions">
                        <button>Publish</button> or <a class="modal-cancel" href="#">close</a>
                </span>
        </p>
    </div>

<!-- Channel suggestion dialog -->
    <div id="modal-channel-suggestion" class="modal-window">
        <h2>Channel suggestions</h2>
        <p>You may be interested in following channels:</p>
        <div id="suggestions">
            <span class="indicator">
                <img src="/static/spinner.gif" />
                <span class="indic-msg">Fetching possible suggestions...</span>
            </span>
            <span class="fail">
                Sorry, no suggestions for you today
            </span>
            <ul>
            </ul>
        </div>
        <p class="modal-menu" style="margin-top: 15px;">
            <span class="indicator">
                <img src="/static/spinner.gif" />
                <span class="indic-msg">Joining...</span>
            </span>
            <span class="modal-actions">
                <button>Join channels</button><a href="#" class="modal-cancel">close</a>
            </span>
        </p>
    </div>

<? if ($circle && $moderator): ?>
    <div id="modal-group-edit" class="modal-window">
        <h1 class="wide">Manage circle</h1>
        
        <? if (!empty($pending)): ?>
        	<div id="add">
            	<label>pending members <small>these members need to be aproved before they can start browsing the circle</small></label>
                
                <ul>
                <? foreach ($pending as $u): ?>
                	<li>
                        <span><input type="checkbox" /></span>
                        <img
                            width="40"
                            src="<?=USER_PIC_REL?>medium_<?=$u['id']?>.jpg"
                            data-tiptitle="<?=$u['fname']?> <?=$u['lname']?>"
                            data-tipid="tip-pending-<?=$u['id']?>"
                        />
                        <a href="/user/<?=$u['uname']?>" class="view">view</a>
                    </li>
                <? endforeach; ?>
                    <div class="clear"></div>
                </ul>

                <input type="submit" class="accept" value="Accept members" />
                <input type="submit" class="reject" value="Reject members" />
                <div class="clear"></div>
            </div><!--add-->
        <? endif; ?>
    	
        <form id="edit">
        
        <div class="left">
            <input type="hidden" name="id" id="edit-id" value="<?=$circle['id']?>">
        
			<label for="edit-title">title   <small>what will your circle be called?</small></label>
            <input type="text" id="edit-title"
                   name="title" 
                   value="<?=$circle['name']?>"
                   class="required"
                   data-tipid="tip-input-title"
            />
            
            <label for="edit-symbol">symbol   <small>leave it for robots</small></label>
            <input type="text" id="edit-symbol"  disabled=""
                   name="symbol"
                   value="<?=$circle['symbol']?>"
                   class="groupDoesNotExists oldSymbol:'<?=$circle['symbol']?>'"
                   data-tipid="tip-input-symbol"
            />
            
            <label for="edit-descr">description   <small>a brief explaination what this circle stands for</small></label>
            <textarea name="descr" id="edit-descr" 
                      class="maxLength:250"
                      data-tipid="tip-input-descr"
            /><?=$circle['descr']?></textarea>
                       
            <input type="submit" class="load" value="If you click that, you can not go back" />
                
        </div><!--left-->
        
        <div class="side">
        	<label for="edit-type">circle type</label>
            <select name="type" id="edit-type">
                <? foreach ($types as $val => $t): ?>
                    <option value="<?=$val?>" <?=($t == $circle['type'] ? ' selected' : '')?>><?=$t?></option>
                <? endforeach; ?>
            </select>
            
            <label for="edit-auth">authentication type</label>
            <select name="auth" id="edit-auth">
                <? foreach ($auths as $val => $t): ?>
                    <option value="<?=$val?>" <?=($t == $circle['auth'] ? ' selected' : '')?>><?=$t?></option>
                <? endforeach; ?>
            </select>
            
            <span>secret <input type="checkbox" name="secret" <?=($circle['secret'] ? ' checked' : '')?>/></span>

            <div style="width: 180px; height: 180px">
                <img src="<?=GROUP_PIC_REL?>large_<?=$circle['id']?>.jpg" 
                     id="avatar-changer"
                     data-tipid="tip-avatar-changer">
            </div>
                    
        </div><!--sidebar-->
        
        <div class="clear"></div>
        
        </form>
    </div><!--modal-->
<? endif; ?>

</div>

