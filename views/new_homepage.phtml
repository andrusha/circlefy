<?php
$last = (!empty($_t['last_tap'])) ? $_t['last_tap'][0] : null;
$inits = array();
if (is_array($_t['groups_bits'])) {
	foreach($_t['groups_bits'] as $bit) {
		array_push($inits, $bit['cid']);
	}	
}
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Language" content="EN" />
<meta name="ROBOTS" content="ALL" />
<meta name="Copyright" content="Copyright (c) 2009 TAP" />
<meta http-equiv="imagetoolbar" content="false" />
<meta name="description" content="TAP communication platform" />
<meta name="keywords" content="real-time, search, TAP, microblogging, communication platform" />

<title>TAP :: BETA</title>

<link rel="shortcut icon" href="/images/cimages/favicon.ico" type="image/x-icon" />
<link rel="icon" href="/images/cimages/favicon.ico" type="image/x-icon" />
<style type="text/css" media="all">@import "views/style_sheets/TextboxList.css";</style>
<style type="text/css" media="all">@import "views/style_sheets/TextboxList.Autocomplete.css";</style>
<link rel="stylesheet" href="views/style_sheets/group_manage.css" type="text/css" />
<link rel="stylesheet" href="views/style_sheets/homepage.css" type="text/css" />
<script type="text/javascript" src="views/javascript/mootools-1.2.3-core-yc.js"></script>
<script type="text/javascript" src="views/javascript/mootools-1.2.3.1-more.js"></script>
<script type="text/javascript" src="views/javascript/textboxlist-complete.js"></script>
<script type="text/javascript" src="views/javascript/mootools-tap.js"></script>
<script type="text/javascript" src="http://mark.tap.info:8000/static/Orbited.js"></script>
<script type="text/javascript">
Tap = window.Tap || {};
Tap.Vars = {
	pcid: ("<?= $_t['pcid'] ?>" * 1),
	uname: "<?= $_SESSION['uname'] ?>",
	currentTap: ("<?= $last['cid'] ?>" * 1),
	currentStream: JSON.decode('<?= json_encode($inits) ?>')
};
</script>
<script type="text/javascript" src="views/javascript/tap.push.js"></script>
<script type="text/javascript" src="views/javascript/tap.home.js"></script>
</head>

<body>

	<?php include(NEW_HEADER); ?>
	
	<div id="tap-feed-outside-more">
		<p>
			<input type="text" name="outside-from" alt="Choose sources.." />				
		</p>
		<p style="clear:both;">
			<a href="#" id="tap-feed-outside-set">Save</a>
		</p>
	</div>

	<div id="main">

		<div id="right-col">
			<h1>Help and Tips</h1>
			<h2>Find your groups faster.</h2>
			<p>You can search through your own groups by filtering them out using the filter-bar. Simply enter in a keyword and hit enter, and all corresponding groups will be displayed.</p>
		</div>

		<div id="center-col">
			<div id="tap-box" class="section">
				<input type="text" id="tap-box-msg" alt="Tap here!" />
				<div id="tap-box-more">
					<input type="text" id="tap-box-people" />
					<a id="tap-box-send" href="#">tap!</a>
					<div style="clear:both"></div>
				</div>
			</div>

			<div id="tap-yours" class="section">
				<div class="section-head">
					<h1>
						Your Last Tap
					</h1>
				</div>
				<div class="section-body">
					<ul id="your-stream" class="tap-stream">
						<?php if ($last == null): ?>
						<li class='welcome_tap'>
							<h1 style="font-size:14px; font-weight:bold; margin-bottom: 5px; color: #4F9CDF;">Welcome To Tap!</h1>
							<p style="margin-bottom: 10px;">Tap allows you to connect with people around you and stay informed about topics you're interested in.</p>
							<p style="margin-bottom: 10px;">You can start by joining a <a href="/groups">group</a>, or you can send a tap right now using the TapBox above. If you get stuck, check out the <a href="/help">Help</a> section, or send a tap to <strong>Support</strong>.</p>
							<p style="margin-bottom: 10px;"><strong>Keep on tapping!</strong></p>
						</li>
						<?php else: ?>
						<li id="yid_<?= $last['cid'] ?>">
							<img src="/user_pics/<?= $last['pic_100'] ?>" class="avatar" alt="<?= $last['uname'] ?>" />
							<div class="tap-actions">
								<a class="tap-respond" href="#">
									Respond (<span class="tap-respond-count"><?= $last['count'] ?></span>)
								</a>
								<p class="tap-respond-last">
									<strong>
										<?= (!empty($last['resp_uname'])) ? $last['resp_uname'] . ":" : "" ?>
									</strong>
									<?= $last['last_resp'] ?>
								</p>
							</div>
							<div class="tap-body">
								<p class="tap-info">
									<span class="tap-from"><?= $last['fname'] . " " . $last['lname'] ?></span>
									<span class="tap-time <?= $last['chat_timestamp_raw'] ?>"><?= $last['chat_timestamp'] ?></span>
									<span class="tap-typing"></span>
								</p>
								<p class="tap-msg"><?= $last['chat_text'] ?>
								</p>
							</div>
							<div class="tap-response-box clarity">
								<ul class="tap-chat">
								</ul>
								<input type="text" class="tap-response" style="width:450px" />
								<!-- <a href="#">Respond</a> or  --><a class="tap-respond-cancel" href="#">Close</a>
							</div>
							<div class="clarity"></div>
						</li>
						<?php endif; ?>
					</ul>
				</div>
			</div>

			<div id="tap-feed" class="section">
				<div class="section-head">
					<h1>
						<input type="text" id="tap-feed-search" alt="Search through feed." />
						<span id="tap-feed-outside-drop"></span>
						<span id="tap-feed-outside">Outside: Off</span>
						<span style="clear:right"></span>
						<img id="tap-feed-icon" src="/group_pics/36wh_default_group.gif" style="float:left; margin-right:10px; height: 20px; width: 20px" />
						<span id="tap-feed-name">Groups Feed</span>
						<img src="/images/loading.gif" id="loading-indicator" style="display:none" />
					</h1>
				</div>
				<div class="section-body">
					<div id="tap-notify"></div>
					<ul id="main-stream" class="tap-stream">
						<?php 
							if (!empty($_t['groups_bits'])):
								foreach($_t['groups_bits'] as $bit): 
						?>
						<li id="tid_<?= $bit['cid'] ?>">
							<img src="/user_pics/<?= $bit['pic_100'] ?>" class="avatar" alt="<?= $bit['uname'] ?>" />
							<div class="tap-actions">
								<a class="tap-respond" href="#">
									Respond (<span class="tap-respond-count"><?= $bit['count'] ?></span>)
								</a>
								<p class="tap-respond-last">
									<strong>
										<?= (!empty($bit['resp_uname'])) ? $bit['resp_uname'] . ":" : "" ?>
									</strong>
									<?= $bit['last_resp'] ?>
								</p>
							</div>
							<div class="tap-body">
								<p class="tap-info">
									<span class="tap-from"><?= $bit['fname'] . " " . $bit['lname'] ?></span>
									<span class="tap-time <?= $bit['chat_timestamp_raw'] ?>"><?= $bit['chat_timestamp'] ?></span>
									<span class="tap-typing"></span>
								</p>
								<p class="tap-msg"><?= $bit['chat_text'] ?>
								</p>
							</div>
							<div class="tap-response-box clarity">
								<ul class="tap-chat">
								</ul>
								<input type="text" class="tap-response" style="width:450px" />
								<!-- <a href="#">Respond</a> or  --><a class="tap-respond-cancel" href="#">Close</a>
							</div>
							<div class="clarity"></div>
						</li>
						<?php 
								endforeach; 
							else:
						?>
						<li class="noresults">
							<p>This feed is too silent. Try sending a tap!</p>
						</li>
						<?php
							endif;
						?>
					</ul>
				</div>
			</div>
		</div>

		<div id="left-col">
			<div id="groups-tab">
				<div class="tab-in" style="color:#fff">My Groups</div>
			</div>
			<div class="tab-list">
				<ul>
					<li id="gid_all" class="group">
						<span class="counter"></span>
						<img src="/group_pics/36wh_default_group.gif" style="display:none;" />
						<strong><a href="#" title="Groups Feed">All Your Groups</a></strong>
					</li>
					<?php foreach ($_t['your_groups'] as $group): ?>
					<li id="gid_<?= $group['gid'] ?>" class="group">
						<span class="counter"></span>
						<img src="/group_pics/<?= $group['pic_36']?>" />
						<a href="#<?= $group['symbol'] ?>" title="<?= $group['gname'] ?>"><?= $group['symbol'] ?></a>
					</li>
					<?php endforeach; ?>
				</ul>
			</div>
		</div>

	</div>

	<div id="templates" style="display:none">
		<ul id="template-bit">
			<# for (var x = this.reverse().length; x--;) { var bit = this[x]; #>
			<li id="tid_<#: bit.cid #>">
				<img src="/user_pics/<#: bit.pic_100 #>" class="avatar" alt="<#: bit.uname #>" />
				<div class="tap-actions">
					<a class="tap-respond" href="#">
						Respond (<span class="tap-respond-count"><#: bit.count #></span>)
					</a>
					<p class="tap-respond-last">
						<strong>
							<#: bit.resp_uname ? bit.resp_uname + ":" : "" #>							
						</strong>
						<#: bit.last_resp || "" #>
					</p>
				</div>
				<div class="tap-body">
					<p class="tap-info">
						<span class="tap-from"><#: [bit.fname, bit.lname].join(" ") #></span>
						<span class="tap-time <#: bit.chat_timestamp_raw #>"><#: bit.chat_timestamp #></span>
						<span class="tap-typing"></span>
					</p>
					<p class="tap-msg"><#: bit.chat_text #>
					</p>
				</div>
				<div class="tap-response-box clarity">
					<ul class="tap-chat">
					</ul>
					<input type="text" class="tap-response" style="width:450px" />
					<!-- <a href="#">Respond</a> or  --><a class="tap-respond-cancel" href="#">Close</a>
				</div>
				<div class="clarity"></div>
			</li>
			<# } #>
		</ul>
		<ul>
			<li id="no-taps" class="noresults">
				<p>There doesn't seem to be anything here.</p>
			</li>
			<li id="no-results" class="noresults">
				<p>
					No taps match your search keyword.
					<a href="#" class="reset-feed">Show all taps.</a>
				</p>
			</li>
		</ul>
	</div>

	<div id="footer">

	</div>

</body>
</html>
